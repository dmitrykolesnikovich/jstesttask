<html lang="en">
<head>
    <script src="https://pixijs.download/release/pixi.min.js"></script>
    <title>test</title>
    <style>* {
        padding: 0;
        margin: 0
    }</style>
</head>
<body>
<script>
    const app = new PIXI.Application({
        background: '#313434',
        width: window.innerWidth,
        height: window.innerHeight,
    });
    app.renderer.autoDensity = true;
    document.body.appendChild(app.view);
    const container = new PIXI.Container();
    app.stage.addChild(container);
    window.onresize = () => {
        app.renderer.resize(window.innerWidth, window.innerHeight);
    };

    const Orientation = {
        LANDSCAPE: 1,
        PORTRAIT: 2,
    }

    function loadLevel(levelId) {
        container.removeChildren()
        PIXI.loadJson.load(`levels/${levelId}/level.json`).then((level) => {
            const mainSlot = level.slots.find(it => it.layer === "standart")
            const orientation = mainSlot.width > mainSlot.height ? Orientation.LANDSCAPE : Orientation.PORTRAIT;
            const width = mainSlot.width;
            const height = mainSlot.height;

            const mainSprite = PIXI.Sprite.from(`levels/${levelId}/images/${mainSlot.name}.jpg`);
            mainSprite.x = mainSlot.x;
            mainSprite.y = mainSlot.y;
            container.addChild(mainSprite);
            for (let slot of level.slots) {
                const sprite = PIXI.Sprite.from(`levels/${levelId}/images/${slot.name}.jpg`);
                sprite.x = slot.x;
                sprite.y = slot.y;

                if (orientation === Orientation.LANDSCAPE) {
                    sprite.y += height + 8;
                } else if (orientation === Orientation.PORTRAIT) {
                    sprite.x += width + 8;
                }
                container.addChild(sprite);

                sprite.interactive = true;
                if (slot !== mainSlot) {
                    sprite.on('pointerdown', () => {
                        const graphics = new PIXI.Graphics()
                        graphics.lineStyle(2, 0x22ff22, 1);
                        graphics.drawRect(0, 0, sprite.width, sprite.height);
                        graphics.endFill();
                        sprite.addChild(graphics);
                    });
                    sprite.tint = new PIXI.Color(0x8888ff);
                } else {
                    sprite.on('pointerdown', (event) => {
                        const graphics = new PIXI.Graphics()
                        graphics.lineStyle(2, 0xff2222, 1);
                        graphics.drawRect(event.x, event.y, 64, 64);
                        graphics.endFill();
                        sprite.addChild(graphics);
                    });
                }
            }
        });
    }

    loadLevel(4);
</script>
</body>
</html>
